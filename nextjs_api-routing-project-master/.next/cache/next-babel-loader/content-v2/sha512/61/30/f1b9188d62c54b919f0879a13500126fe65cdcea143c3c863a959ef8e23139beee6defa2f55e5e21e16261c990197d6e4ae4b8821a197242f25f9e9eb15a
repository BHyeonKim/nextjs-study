{"ast":null,"code":"import { connectDatabase, getAllDocuments, insertDocument } from '../../../helpers/db-utils';\n\nasync function handler(req, res) {\n  const {\n    eventId\n  } = req.query;\n  let client;\n\n  try {\n    client = await connectDatabase();\n  } catch (error) {\n    res.status(500).json({\n      message: 'Connecting to the database failed.'\n    });\n    return;\n  }\n\n  if (req.method === 'POST') {\n    const {\n      email,\n      name,\n      text\n    } = req.body; // server-side validation\n\n    if (!email.includes('@') || !name || name.trim() === '' || !text || text.trim() === '') {\n      res.status(422).json({\n        message: 'Invalid input.'\n      });\n      client.close();\n      return;\n    }\n\n    const newComment = {\n      email,\n      name,\n      text,\n      eventId\n    };\n    let result;\n\n    try {\n      result = await insertDocument(client, 'comments', newComment);\n      newComment._id = result.insertedId;\n      res.status(201).json({\n        message: 'Added successfully!',\n        comment: newComment\n      });\n    } catch (error) {\n      res.status(500).json({\n        message: 'Inserting comment failed.'\n      });\n    }\n  }\n\n  if (req.method === 'GET') {\n    let documents;\n\n    try {\n      documents = await getAllDocuments(client, 'comments', {\n        _id: -1\n      });\n      res.status(200).json({\n        comments: documents\n      });\n    } catch (error) {\n      res.status(500).json({\n        message: 'Getting comments failed.'\n      });\n    }\n  }\n\n  client.close();\n}\n\nexport default handler;","map":{"version":3,"sources":["/Users/kimbohyeon/NextJS/nextjs_api-routing-project/pages/api/comments/[eventId].js"],"names":["connectDatabase","getAllDocuments","insertDocument","handler","req","res","eventId","query","client","error","status","json","message","method","email","name","text","body","includes","trim","close","newComment","result","_id","insertedId","comment","documents","comments"],"mappings":"AAAA,SACEA,eADF,EAEEC,eAFF,EAGEC,cAHF,QAIO,2BAJP;;AAMA,eAAeC,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC/B,QAAM;AAAEC,IAAAA;AAAF,MAAcF,GAAG,CAACG,KAAxB;AAEA,MAAIC,MAAJ;;AAEA,MAAI;AACFA,IAAAA,MAAM,GAAG,MAAMR,eAAe,EAA9B;AACD,GAFD,CAEE,OAAOS,KAAP,EAAc;AACdJ,IAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAArB;AACA;AACD;;AAED,MAAIR,GAAG,CAACS,MAAJ,KAAe,MAAnB,EAA2B;AACzB,UAAM;AAAEC,MAAAA,KAAF;AAASC,MAAAA,IAAT;AAAeC,MAAAA;AAAf,QAAwBZ,GAAG,CAACa,IAAlC,CADyB,CAGzB;;AACA,QACE,CAACH,KAAK,CAACI,QAAN,CAAe,GAAf,CAAD,IACA,CAACH,IADD,IAEAA,IAAI,CAACI,IAAL,OAAgB,EAFhB,IAGA,CAACH,IAHD,IAIAA,IAAI,CAACG,IAAL,OAAgB,EALlB,EAME;AACAd,MAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACAJ,MAAAA,MAAM,CAACY,KAAP;AACA;AACD;;AAED,UAAMC,UAAU,GAAG;AACjBP,MAAAA,KADiB;AAEjBC,MAAAA,IAFiB;AAGjBC,MAAAA,IAHiB;AAIjBV,MAAAA;AAJiB,KAAnB;AAOA,QAAIgB,MAAJ;;AAEA,QAAI;AACFA,MAAAA,MAAM,GAAG,MAAMpB,cAAc,CAACM,MAAD,EAAS,UAAT,EAAqBa,UAArB,CAA7B;AACAA,MAAAA,UAAU,CAACE,GAAX,GAAiBD,MAAM,CAACE,UAAxB;AACAnB,MAAAA,GAAG,CACAK,MADH,CACU,GADV,EAEGC,IAFH,CAEQ;AAAEC,QAAAA,OAAO,EAAE,qBAAX;AAAkCa,QAAAA,OAAO,EAAEJ;AAA3C,OAFR;AAGD,KAND,CAME,OAAOZ,KAAP,EAAc;AACdJ,MAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACD;AACF;;AAED,MAAIR,GAAG,CAACS,MAAJ,KAAe,KAAnB,EAA0B;AACxB,QAAIa,SAAJ;;AACA,QAAI;AACFA,MAAAA,SAAS,GAAG,MAAMzB,eAAe,CAACO,MAAD,EAAS,UAAT,EAAqB;AAAEe,QAAAA,GAAG,EAAE,CAAC;AAAR,OAArB,CAAjC;AACAlB,MAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEgB,QAAAA,QAAQ,EAAED;AAAZ,OAArB;AACD,KAHD,CAGE,OAAOjB,KAAP,EAAc;AACdJ,MAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACD;AACF;;AAEDJ,EAAAA,MAAM,CAACY,KAAP;AACD;;AAED,eAAejB,OAAf","sourcesContent":["import {\n  connectDatabase,\n  getAllDocuments,\n  insertDocument,\n} from '../../../helpers/db-utils';\n\nasync function handler(req, res) {\n  const { eventId } = req.query;\n\n  let client;\n\n  try {\n    client = await connectDatabase();\n  } catch (error) {\n    res.status(500).json({ message: 'Connecting to the database failed.' });\n    return;\n  }\n\n  if (req.method === 'POST') {\n    const { email, name, text } = req.body;\n\n    // server-side validation\n    if (\n      !email.includes('@') ||\n      !name ||\n      name.trim() === '' ||\n      !text ||\n      text.trim() === ''\n    ) {\n      res.status(422).json({ message: 'Invalid input.' });\n      client.close();\n      return;\n    }\n\n    const newComment = {\n      email,\n      name,\n      text,\n      eventId,\n    };\n\n    let result;\n\n    try {\n      result = await insertDocument(client, 'comments', newComment);\n      newComment._id = result.insertedId;\n      res\n        .status(201)\n        .json({ message: 'Added successfully!', comment: newComment });\n    } catch (error) {\n      res.status(500).json({ message: 'Inserting comment failed.' });\n    }\n  }\n\n  if (req.method === 'GET') {\n    let documents;\n    try {\n      documents = await getAllDocuments(client, 'comments', { _id: -1 });\n      res.status(200).json({ comments: documents });\n    } catch (error) {\n      res.status(500).json({ message: 'Getting comments failed.' });\n    }\n  }\n\n  client.close();\n}\n\nexport default handler;\n"]},"metadata":{},"sourceType":"module"}