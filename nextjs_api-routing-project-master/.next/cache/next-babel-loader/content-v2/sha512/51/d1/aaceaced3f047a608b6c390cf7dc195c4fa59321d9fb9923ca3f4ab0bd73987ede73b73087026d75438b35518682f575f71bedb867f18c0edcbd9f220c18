{"ast":null,"code":"import { MongoClient } from 'mongodb';\n\nasync function handler(req, res) {\n  const {\n    eventId\n  } = req.query;\n  const client = await MongoClient.connect('mongodb+srv://user:wDewiEi9ceXTNfj2@cluster0.xlism.mongodb.net/events?retryWrites=true&w=majority');\n\n  if (req.method === 'POST') {\n    const {\n      email,\n      name,\n      text\n    } = req.body; // server-side validation\n\n    if (!email.includes('@') || !name || name.trim() === '' || !text || text.trim() === '') {\n      res.status(422).json({\n        message: 'Invalid input.'\n      });\n      return;\n    }\n\n    const newComment = {\n      email,\n      name,\n      text,\n      eventId\n    };\n    const db = client.db();\n    const result = await db.collection('comments').insertOne(newComment);\n    console.log(result);\n    res.status(201).json({\n      message: 'Added successfully!',\n      comment: newComment\n    });\n  }\n\n  if (req.method === 'GET') {\n    const dummyList = [{\n      id: 'c1',\n      name: 'bobo1',\n      email: 'test@test.com',\n      text: 'test text1'\n    }, {\n      id: 'c2',\n      name: 'bobo2',\n      email: 'test@test.com',\n      text: 'test text2'\n    }];\n    res.status(200).json({\n      comments: dummyList\n    });\n  }\n\n  client.close();\n}\n\nexport default handler;","map":{"version":3,"sources":["/Users/kimbohyeon/NextJS/nextjs_api-routing-project/pages/api/comments/[eventId].js"],"names":["MongoClient","handler","req","res","eventId","query","client","connect","method","email","name","text","body","includes","trim","status","json","message","newComment","db","result","collection","insertOne","console","log","comment","dummyList","id","comments","close"],"mappings":"AAAA,SAASA,WAAT,QAA4B,SAA5B;;AAEA,eAAeC,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC/B,QAAM;AAAEC,IAAAA;AAAF,MAAcF,GAAG,CAACG,KAAxB;AAEA,QAAMC,MAAM,GAAG,MAAMN,WAAW,CAACO,OAAZ,CACnB,mGADmB,CAArB;;AAIA,MAAIL,GAAG,CAACM,MAAJ,KAAe,MAAnB,EAA2B;AACzB,UAAM;AAAEC,MAAAA,KAAF;AAASC,MAAAA,IAAT;AAAeC,MAAAA;AAAf,QAAwBT,GAAG,CAACU,IAAlC,CADyB,CAGzB;;AACA,QACE,CAACH,KAAK,CAACI,QAAN,CAAe,GAAf,CAAD,IACA,CAACH,IADD,IAEAA,IAAI,CAACI,IAAL,OAAgB,EAFhB,IAGA,CAACH,IAHD,IAIAA,IAAI,CAACG,IAAL,OAAgB,EALlB,EAME;AACAX,MAAAA,GAAG,CAACY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACA;AACD;;AAED,UAAMC,UAAU,GAAG;AACjBT,MAAAA,KADiB;AAEjBC,MAAAA,IAFiB;AAGjBC,MAAAA,IAHiB;AAIjBP,MAAAA;AAJiB,KAAnB;AAOA,UAAMe,EAAE,GAAGb,MAAM,CAACa,EAAP,EAAX;AAEA,UAAMC,MAAM,GAAG,MAAMD,EAAE,CAACE,UAAH,CAAc,UAAd,EAA0BC,SAA1B,CAAoCJ,UAApC,CAArB;AAEAK,IAAAA,OAAO,CAACC,GAAR,CAAYJ,MAAZ;AAEAjB,IAAAA,GAAG,CACAY,MADH,CACU,GADV,EAEGC,IAFH,CAEQ;AAAEC,MAAAA,OAAO,EAAE,qBAAX;AAAkCQ,MAAAA,OAAO,EAAEP;AAA3C,KAFR;AAGD;;AAED,MAAIhB,GAAG,CAACM,MAAJ,KAAe,KAAnB,EAA0B;AACxB,UAAMkB,SAAS,GAAG,CAChB;AACEC,MAAAA,EAAE,EAAE,IADN;AAEEjB,MAAAA,IAAI,EAAE,OAFR;AAGED,MAAAA,KAAK,EAAE,eAHT;AAIEE,MAAAA,IAAI,EAAE;AAJR,KADgB,EAOhB;AACEgB,MAAAA,EAAE,EAAE,IADN;AAEEjB,MAAAA,IAAI,EAAE,OAFR;AAGED,MAAAA,KAAK,EAAE,eAHT;AAIEE,MAAAA,IAAI,EAAE;AAJR,KAPgB,CAAlB;AAeAR,IAAAA,GAAG,CAACY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEY,MAAAA,QAAQ,EAAEF;AAAZ,KAArB;AACD;;AAEDpB,EAAAA,MAAM,CAACuB,KAAP;AACD;;AAED,eAAe5B,OAAf","sourcesContent":["import { MongoClient } from 'mongodb';\n\nasync function handler(req, res) {\n  const { eventId } = req.query;\n\n  const client = await MongoClient.connect(\n    'mongodb+srv://user:wDewiEi9ceXTNfj2@cluster0.xlism.mongodb.net/events?retryWrites=true&w=majority'\n  );\n\n  if (req.method === 'POST') {\n    const { email, name, text } = req.body;\n\n    // server-side validation\n    if (\n      !email.includes('@') ||\n      !name ||\n      name.trim() === '' ||\n      !text ||\n      text.trim() === ''\n    ) {\n      res.status(422).json({ message: 'Invalid input.' });\n      return;\n    }\n\n    const newComment = {\n      email,\n      name,\n      text,\n      eventId,\n    };\n\n    const db = client.db();\n\n    const result = await db.collection('comments').insertOne(newComment);\n\n    console.log(result);\n\n    res\n      .status(201)\n      .json({ message: 'Added successfully!', comment: newComment });\n  }\n\n  if (req.method === 'GET') {\n    const dummyList = [\n      {\n        id: 'c1',\n        name: 'bobo1',\n        email: 'test@test.com',\n        text: 'test text1',\n      },\n      {\n        id: 'c2',\n        name: 'bobo2',\n        email: 'test@test.com',\n        text: 'test text2',\n      },\n    ];\n\n    res.status(200).json({ comments: dummyList });\n  }\n\n  client.close();\n}\n\nexport default handler;\n"]},"metadata":{},"sourceType":"module"}